<?xml version="1.0" encoding="UTF-8" ?>
<Page
    x:Class="CodingWithCalvin.VSToolbox.Views.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:CodingWithCalvin.VSToolbox.Core.Models"
    Loaded="OnPageLoaded"
    mc:Ignorable="d">
    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="16" Margin="0,0,0,16">
            <TextBlock
                Text="Current Installations"
                FontSize="28"
                FontWeight="SemiBold"
                Style="{StaticResource AppTitleStyle}"/>
            <Button
                Command="{x:Bind ViewModel.RefreshCommand}"
                ToolTipService.ToolTip="Refresh"
                VerticalAlignment="Center">
                <SymbolIcon Symbol="Refresh"/>
            </Button>
        </StackPanel>

        <!-- VS Instances List -->
        <ListView
            Grid.Row="1"
            ItemsSource="{x:Bind ViewModel.Instances}"
            SelectionMode="None">
            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="Padding" Value="0"/>
                    <Setter Property="Margin" Value="0,2"/>
                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                </Style>
            </ListView.ItemContainerStyle>
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="models:LaunchableInstance">
                    <Border
                        x:Name="RowBorder"
                        BorderThickness="3,0,0,0"
                        BorderBrush="Transparent"
                        CornerRadius="4"
                        Background="Transparent"
                        PointerEntered="OnRowPointerEntered"
                        PointerExited="OnRowPointerExited">
                        <Grid Padding="12,8" ColumnSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Icon -->
                            <Image
                                Grid.Column="0"
                                Width="32" Height="32"
                                VerticalAlignment="Center"
                                Source="{x:Bind IconPath, Converter={StaticResource FilePathToImageConverter}}"/>

                            <!-- Info -->
                            <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="2">
                                <TextBlock
                                    Text="{x:Bind DisplayName}"
                                    FontSize="14"
                                    FontWeight="SemiBold"/>
                                <TextBlock
                                    Text="{x:Bind BuildNumber}"
                                    FontSize="11"
                                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <TextBlock
                                    Text="{x:Bind InstallationPath}"
                                    FontSize="10"
                                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                    TextTrimming="CharacterEllipsis"/>
                            </StackPanel>

                            <!-- Channel Type Badge -->
                            <Border
                                Grid.Column="2"
                                CornerRadius="4"
                                Padding="8,4"
                                VerticalAlignment="Center"
                                Background="{x:Bind ChannelType, Converter={StaticResource ChannelTypeToBrushConverter}}">
                                <TextBlock
                                    Text="{x:Bind ChannelType}"
                                    FontSize="10"
                                    FontWeight="SemiBold"
                                    Foreground="White"/>
                            </Border>

                            <!-- Action Buttons -->
                            <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                                <!-- Fixed-width container to maintain alignment when Play button is hidden -->
                                <Border Width="40">
                                    <Button
                                        Click="OnLaunchClick"
                                        ToolTipService.ToolTip="Launch"
                                        Visibility="{x:Bind CanLaunch, Converter={StaticResource BoolToVisibilityConverter}}"
                                        Padding="8"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Opacity="0.6"
                                        PointerEntered="OnButtonPointerEntered"
                                        PointerExited="OnButtonPointerExited">
                                        <SymbolIcon Symbol="Play" Foreground="#22C55E"/>
                                    </Button>
                                </Border>
                                <Button
                                    ToolTipService.ToolTip="Options"
                                    Padding="8"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Opacity="0.6"
                                    PointerEntered="OnButtonPointerEntered"
                                    PointerExited="OnButtonPointerExited">
                                    <Button.Flyout>
                                        <MenuFlyout Placement="Bottom" Opening="OnOptionsFlyoutOpening">
                                        </MenuFlyout>
                                    </Button.Flyout>
                                    <SymbolIcon Symbol="Setting" Foreground="#8A2BE2"/>
                                </Button>
                            </StackPanel>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <!-- Status Bar -->
        <TextBlock
            Grid.Row="2"
            Margin="0,16,0,0"
            Text="{x:Bind ViewModel.StatusText, Mode=OneWay}"
            VerticalAlignment="Center"
            Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>

        <!-- Loading Overlay -->
        <Grid Grid.RowSpan="3"
              Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
              Background="{ThemeResource LayerOnMicaBaseAltFillColorDefaultBrush}">
            <ProgressRing IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"/>
        </Grid>
    </Grid>
</Page>
